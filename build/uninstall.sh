#!/bin/bash -xe

remove_line()
{
	SEARCH_TERM="$1"
	FILE="$2"
	TMP_FILE=$(make_temp_file $FILE)
	test -f "$FILE" || return 0
	if grep -v "$SEARCH_TERM" "$FILE" > "$TMP_FILE"; then
		mv "$TMP_FILE" "$FILE"
	else
		rm -f "$FILE" "$TMP_FILE"
	fi
}

restore_backup()
{
	FILE=$1
	BACKUP_FILE=$(make_backup_file $FILE)
	rm -f "$FILE"
	if [ -f "$BACKUP_FILE" ]; then
		mv "$BACKUP_FILE" "$FILE"
	fi
}


[ $# -eq 1 ] || exit 1

. "$(dirname $BASH_SOURCE)/common.sh"

PARAMS_FILE="$1"
. "${PARAMS_FILE}"

test -d "$ETC_PLACEHOLDER" && rm -r "$ETC_PLACEHOLDER"
test -d "$BIN_PLACEHOLDER" && rm -r "$BIN_PLACEHOLDER"
test -d "$SBIN_PLACEHOLDER" && rm -r "$SBIN_PLACEHOLDER"

remove_line "generated by $PROJECT" ~/.bashrc
remove_line "generated by $PROJECT" ~/.vimrc

restore_backup ~/.gitconfig
