#!/bin/bash

PROGRAM=$(basename $0)
DESCRIPTION="capitalize first letters"
PARAMS="[file...]"
OPTIONS="[-hi]"

usage()
{
	[ $1 -ne 0 ] && exec >&2

	cat << EOF
$PROGRAM - $DESCRIPTION
usage:
$PROGRAM $OPTIONS $PARAMS

options:
-i	in-place: edit files in place
-h	help: show this help message and exit.

exit status:
255	some options are bad
otherwise it is the exit status from sed(1).
EOF

    exit $1
}

capitalize_first_paragraph_char()
{
	sed -i 's,^[^[:alnum:]]*.,\U&\E,g' "$@"
}

capitalize_new_sentence()
{
	sed -i 's,[\.!?]\s*.,\U&\E,g' "$@"
}

STDOUT=true
while getopts hi OPTION; do
	case $OPTION in
		h) usage 0 ;;
		i) STDOUT=false ;;
		\?) usage 255 ;;
	esac
done
shift $((OPTIND - 1))

if $STDOUT; then
	OUT=$(mktemp)
	cat "$@" > "$OUT"
	set -- "$OUT"
fi
capitalize_first_paragraph_char "$@" || exit $?
capitalize_new_sentence "$@" || exit $?
if $STDOUT; then
	cat "$OUT"
	rm "$OUT"
fi
