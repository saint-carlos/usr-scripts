#!/bin/bash

PROGRAM=$(basename $0)
DESCRIPTION="diff between diffs"
PARAMS="revision-range revision-range"
OPTIONS="[-h]"

usage()
{
	[ $1 -ne 0 ] && exec >&2

	cat << EOF
$PROGRAM - $DESCRIPTION
usage:
$PROGRAM $OPTIONS $PARAMS
revision-range can be a single commit.

options:
-h	help: show this help message and exit.

exit status:
255	bad arguments
otherwise same as vimdiff
EOF
    exit $1
}

while getopts h OPTION; do
	case $OPTION in
		h) usage 0 ;;
		\?) usage 255 ;;
	esac
done
shift $((OPTIND - 1))
[ $# -eq 2 ] || usage 255

FROM_CMD=show
case $1 in
	*..*) FROM_CMD=diff;;
esac
TO_CMD=show
case $2 in
	*..*) TO_CMD=diff;;
esac
exec vimdiff -c 'set diffexpr=GitDiffDiff()' <(git $FROM_CMD $1) <(git $TO_CMD $2)
